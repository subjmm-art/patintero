"use strict";(globalThis.webpackChunk_github_ui_github_ui=globalThis.webpackChunk_github_ui_github_ui||[]).push([[39837],{39837:(e,t,s)=>{s.d(t,{A:()=>K});var i=s(74848),l=s(69726),n=s(96540),a=s(73017),r=s(40961),o=s(87670);let d="TaskListItems-module__task-list-item--wcmow";var m=s(46720),c=s(20263),u=s(80752);let h=e=>"string"==typeof e?.taskBox&&e?.text?.match(/[^\s\\]/)!==null,k=({container:e,nestedItems:t,globalIndex:s,markdownIndex:i,items:l,itemsData:n,nested:a=!1,lists:r,parentIsChecklist:o,hasDifferentListTypes:d})=>(l.map((l,m)=>{let c=Array.from(l.querySelectorAll(":scope > ul > li:not(.base-task-list-item), :scope > ol > li:not(.base-task-list-item)"))??[],u=Array.from(l.querySelectorAll(":scope > ul > li.task-list-item, :scope > ol > li.task-list-item"))??[],h=(Array.from(l.querySelectorAll("ul > li.task-list-item, ol > li.task-list-item, li.task-list-item"))??[]).length,g=[];h>0&&t.set(s.toString(),h);let p=l.classList.contains("task-list-item")?function(e,t){let s=t.parentElement?.closest(".contains-task-list");if(!s)throw Error("Could not find the item's parent list");let i=t?Array.from(s.children).indexOf(t):-1;return[e.indexOf(s),i]}(r,l):void 0,{title:f,content:x}=function(e){let t="",s="";for(let l of e.childNodes){var i;if("INPUT"===(i=l).nodeName||"UL"===i.nodeName||"OL"===i.nodeName||"#comment"===l.nodeName)continue;let e=l.textContent||"";if("#text"===l.nodeName){t+=e,s+=e;continue}if("CODE"===l.nodeName){t+=`\`${e}\``,s+=l.outerHTML;continue}t+=e,s+=l.outerHTML}return{title:t.trim(),content:s}}(l);n.push({id:s.toString(),index:m,title:f,content:x,checked:l.querySelector(".task-list-item-checkbox")?.checked===!0,position:p,container:l.parentElement,nested:a,children:g,markdownIndex:l.classList.contains("task-list-item")?i+=1:-1,isBullet:l.parentElement?.tagName==="UL"&&!l.classList.contains("task-list-item"),isNumbered:l.parentElement?.tagName==="OL"&&!l.classList.contains("task-list-item"),parentIsChecklist:o,hasNestedItems:h>0,hasDifferentListTypes:d});let I=c.length>0&&k({container:e,nestedItems:t,globalIndex:s+1,markdownIndex:i,items:c,itemsData:g,nested:!0,lists:r,parentIsChecklist:l.classList.contains("task-list-item"),hasDifferentListTypes:u.length>0&&c.length!==u.length});s=I?I.globalIndex:s+1,i=I?I.markdownIndex:i}),{globalIndex:s,markdownIndex:i}),g=async({markdownValue:e,markdownIndex:t,onChange:s})=>{let i=e.split(/\r?\n/),l=null,n=!1;for(let e=0,a=0;e<i.length;e++){let r=i[e];if(r.trim().startsWith("\x3c!--")&&(n=!0),n){r.trim().endsWith("--\x3e")&&(n=!1);continue}if(l){if(x(r,l)){l=null;continue}}else l=f(r);if(l)continue;let o=(0,u.VB)(r);if(h(o)){if(a===t){let t=(0,u.a1)(p(o));i.splice(e,1,t);let l=i.join(`
`);return await s(l)}a++}}},p=e=>({...e,taskBox:"[ ]"===e.taskBox?"[x]":"[ ]"}),f=e=>{let t=e.match(/^ {0,3}(`{3,}|~{3,})[^`]*$/);return t?t[1]:null},x=(e,t)=>RegExp(`^ {0,3}${t}${t[0]}* *$`).test(e);var I=s(94236),L=s(26108),y=s(5524),b=s(38621);let T=({totalItems:e,onConvertToIssue:t,onConvertToSubIssue:s,item:l,allowIssueConversion:a,allowSubIssueConversion:r,disabled:d,setIsConverting:m,allowReordering:c,...u})=>{let h,{title:k,index:g,id:p}=l,{moveToPosition:f}=(0,o.gY)(),[x,T]=(0,n.useState)(!1),v=(0,n.useMemo)(()=>`task-list-menu-item-${p}`,[p]),N=e=>{if(e){let e=Array.from(document.querySelectorAll('[id^="task-list-menu-item-"]'));if(e.length>0){let t=e[Math.min(g,e.length-1)];t?.focus()}}else{let e=document.getElementById(v);e&&e.focus()}},_=({moveAction:e,e:t})=>{switch(t.preventDefault(),t.stopPropagation(),T(!1),e){case"up":f(g,g-1,!0);break;case"down":f(g,g+1,!1)}},w=({e,move:i,convertToIssue:n,convertToSubIssue:a})=>{e.preventDefault(),e.stopPropagation(),"Enter"===e.code&&i&&_({moveAction:i,e}),"Enter"===e.code&&n&&(T(!1),t?.(l,m,()=>{N(!1)})),"Enter"===e.code&&a&&(T(!1),s?.(l,m,()=>{N(!0)})),"Escape"===e.code&&T(!1)};return(0,i.jsxs)(I.W,{open:x,onOpenChange:T,children:[(0,i.jsx)(I.W.Anchor,{id:v,children:(0,i.jsx)(L.K,{"data-testid":u["data-testid"],icon:b.KebabHorizontalIcon,variant:"invisible","aria-label":(h=k,`Open ${h} task options`),disabled:d,className:"TaskListMenu-module__TaskListMenuTriggerButton--Qskh6"})}),(0,i.jsx)(I.W.Overlay,{children:(0,i.jsxs)(y.l,{children:[c&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(y.l.Item,{onClick:e=>_({moveAction:"up",e}),onKeyDown:e=>w({e,move:"up"}),disabled:0===g,children:[(0,i.jsx)(y.l.LeadingVisual,{children:(0,i.jsx)(b.ChevronUpIcon,{})}),"Move up"]}),(0,i.jsxs)(y.l.Item,{onClick:e=>_({moveAction:"down",e}),onKeyDown:e=>w({e,move:"down"}),disabled:g===e-1,children:[(0,i.jsx)(y.l.LeadingVisual,{children:(0,i.jsx)(b.ChevronDownIcon,{})}),"Move down"]})]}),a&&t&&(0,i.jsxs)(y.l.Item,{onClick:()=>t?.(l,m),onKeyDown:e=>w({e,convertToIssue:!0}),"data-testid":u["data-testid"]&&`${u["data-testid"]}-convert`,children:[(0,i.jsx)(y.l.LeadingVisual,{children:(0,i.jsx)(b.IssueOpenedIcon,{})}),"Convert to issue"]}),r&&s&&(0,i.jsxs)(y.l.Item,{onClick:()=>s?.(l,m),onKeyDown:e=>w({e,convertToSubIssue:!0}),"data-testid":u["data-testid"]&&`${u["data-testid"]}-convert-sub-issue`,children:[(0,i.jsx)(y.l.LeadingVisual,{children:(0,i.jsx)(b.IssueTracksIcon,{})}),"Convert to sub-issue"]})]})})]})};try{T.displayName||(T.displayName="TaskListMenu")}catch{}let v={ADD_TAGS:["math-renderer"],ADD_ATTR:["style","data-run-id","data-catalyst","class"]},N=/\/issues\/\d*\d/,_=(e,t)=>{let s=document.createElement("div");s.innerHTML=e;let i=s.querySelectorAll("span.reference");if(0===i.length)return!0;if(t||i.length>1)return!1;let l=i[0];return l.remove(),""===s.innerHTML.trim()&&!!N.test(l.innerHTML)};function w({markdownValue:e,onChange:t,onConvertToIssue:s,onConvertToSubIssue:a,nested:r=!1,position:d=1,item:u,totalItems:h,disabled:k,hideActions:p,itemIdToFocus:f,setitemIdToFocus:x,toggledItem:I,setToggledItem:L}){let[y,b]=(0,n.useState)(u.checked),[N,w]=(0,n.useState)(!1),[j,C]=(0,n.useState)(!1);(0,n.useEffect)(()=>{if(f&&!k){let e;(e=document.getElementById(`task-list-menu-item-${f}`))&&e.focus(),x?.(null)}},[f,k,x]),(0,n.useEffect)(()=>{I&&!k&&L(null)},[I,k,L]);let S=(0,n.useCallback)(e=>{b(!u.checked),L(u.id),g({markdownValue:e,markdownIndex:u.markdownIndex,onChange:t})},[u,t,L]),$=!r&&!u.hasDifferentListTypes||r&&d<2&&!u.parentIsChecklist&&!u.hasDifferentListTypes,[A,D]=(0,n.useMemo)(()=>[_(u.content,!0),_(u.content,!1)],[u.content]),B=`tasklist-item-${d}-${u.markdownIndex}`,M=!r||s&&a?"TaskListItem-module__task-list-item--cjTUf":"TaskListItem-module__no-convert-task-list-item--LET1o";return M+=` ${r&&h>0?"contains-task-list":""}`,M+=k?" TaskListItem-module__disabled--OHcK5":"",(0,i.jsxs)("div",{className:M,onMouseEnter:()=>w(!0),onMouseLeave:()=>w(!1),"data-testid":B,children:[(0,i.jsxs)("div",{className:"TaskListItem-module__left-aligned-content--xZ735",children:[(0,i.jsx)("div",{className:"TaskListItem-module__drag-drop-container--oJzzq",children:$&&!k&&(0,i.jsx)(o.BS.DragTrigger,{className:`TaskListItem-module__drag-handle-icon--pdSL7 ${N?"TaskListItem-module__show-trigger--HU0ll":""}`,style:{width:"20px",height:"28px"}})}),(0,i.jsxs)("div",{className:"TaskListItem-module__checkbox-items--pIbRT",id:`checkbox-item-${u.id}`,children:[(0,i.jsx)(m.A,{autoFocus:u.id===I,checked:y,disabled:k,onChange:t=>{t.preventDefault(),t.stopPropagation(),S(e)},"aria-label":`${u.title} checklist item`,className:"TaskListItem-module__taskStatusCheckbox--FJC87"}),(0,i.jsx)(c.JU,{html:u.content,className:"TaskListItem-module__task-list-html--dnlap",domPurifyConfig:v})]})]}),(0,i.jsxs)("div",{className:"TaskListItem-module__TaskListItemActionsContainer--Bm18Z",children:[j&&(0,i.jsx)(l.A,{size:"small"}),!p&&$&&u.position&&!j&&(0,i.jsx)(T,{"data-testid":`${B}-menu`,onConvertToIssue:s,onConvertToSubIssue:a,totalItems:h,item:u,disabled:k,allowIssueConversion:A,allowSubIssueConversion:D,setIsConverting:C,allowReordering:$})]})]})}try{w.displayName||(w.displayName="TaskListItem")}catch{}function j({item:e,position:t}){let s=`tasklist-item-${t}-${e.markdownIndex}`;return(0,i.jsx)(c.Pk,{html:e.content,as:"div","data-testid":s,className:"ListItem-module__ListItemContent--QTxoX"})}try{j.displayName||(j.displayName="ListItem")}catch{}let C=(e,t)=>{let s,i=t.split(/\r?\n/),l=-1,n=-1,a=-1;for(let[t,r]of i.entries()){let i=(0,u.VB)(r),o=i?.leadingWhitespace.length;if(s&&(!r||void 0!==o&&o<=s.leadingWhitespace.length)){n=t>0?t-1:0;break}i&&h(i)&&++a===e&&(l=t,s=i)}return{startLineNumber:l,endLineNumber:n=-1===n?i.length-1:n}},S=({tasklists:e,markdownValue:t,externalOnChange:s,onConvertToIssue:l,onConvertToSubIssue:a,tasklistData:m,setTasklistData:c,disabled:u,viewerCanUpdate:h})=>{let[k,g]=(0,n.useState)(!1),[p,f]=(0,n.useState)(null),[x,I]=(0,n.useState)(null),L=(0,n.useCallback)(async({dragMetadata:e,dropMetadata:i,isBefore:l,items:n,container:a})=>{if(e.id===i?.id||u)return;g(!0);let r=n.find(t=>t.id===e.id)?.markdownIndex,o=n.find(e=>e.id===i.id)?.markdownIndex;if(void 0===r||void 0===o)return;let d=((e,t,s,i)=>{let{startLineNumber:l,endLineNumber:n}=C(s,e),{startLineNumber:a,endLineNumber:r}=C(i,e),o=e.split(/\r?\n/),d=n-l+1,m=[...o].splice(l,d);return t?(o.splice(l,d),o.splice(a,0,...m)):(o.splice(r+1,0,...m),o.splice(l,d)),o.join(`
`)})(t,l,r,o);c(((e,t,s,i,l,n)=>{let a=new Map(i),r=e.findIndex(e=>e.id===t),o=e[r];if(!o)return a;let d=[...e];d.splice(r,1);let m=d.findIndex(e=>e.id===s);d.splice(l?m:m+1,0,o);let c=i.get(n);if(!c)return a;if(c===e)a.set(n,d);else{let t=s=>{for(let i of s)i.children===e?i.children=d:i.children&&t(i.children)};t(c),a.set(n,c)}return a})(n,e.id,i.id,m,l,a)),s&&(await s(d),g(!1),f(i.id))},[u,t,m,c,s]),y=(0,n.useCallback)(async e=>{s&&(g(!0),await s(e),g(!1))},[s]);function b(e,s,r,m,c,g){let T=!e.isBullet&&!e.isNumbered,v="OL"===r.tagName?"ol":"UL"===r.tagName?"ul":"div";return(0,i.jsxs)(n.Fragment,{children:[T&&(0,i.jsx)(w,{toggledItem:x,setToggledItem:I,markdownValue:t,onChange:y,onConvertToIssue:l,onConvertToSubIssue:a,nested:c,position:s,item:e,totalItems:m,disabled:u||k,hideActions:!h&&!k,setitemIdToFocus:f,itemIdToFocus:p}),!T&&(0,i.jsx)(j,{item:e,position:s}),e.children.length>0&&(0,i.jsx)(o.BS,{items:e.children,onDrop:t=>L({...t,items:e.children,container:r}),renderOverlay:(t,l)=>(0,i.jsx)(o.BS.Item,{index:l,id:t.id,title:t.title,hideTrigger:!0,className:d,isDragOverlay:!0,style:{marginLeft:"-30px"},children:b(t,s+1,r,e.children.length,!0,!0)},t.id),as:"div",children:(0,i.jsx)(v,{className:"base-list-item",style:{listStyleType:"none",marginLeft:T?"12px":"-28px"},children:e.children.map((t,l)=>{let n=$({child:t,position:s}),a=A({child:t,isDragOverlay:g}),d=D({child:t,isDragOverlay:g});return(0,i.jsx)(o.BS.Item,{index:l,id:t.id,title:t.title,hideTrigger:!0,className:`${n} ${a} ${d}`,as:B(e)?"li":"div",children:b(t,s+1,r,e.children.length,!0,g)},t.id)})})})]},e.index)}return(0,n.useMemo)(()=>(0,i.jsx)(i.Fragment,{children:e.map((e,t)=>{let s=m.get(e)||[],l=s.filter(e=>!e.isBullet&&!e.isNumbered),n="OL"===e.tagName?"ol":"UL"!==e.tagName||e.classList.contains("contains-task-list")&&l.length===s.length?"div":"ul";return s.length>0?(0,r.createPortal)((0,i.jsx)("li",{className:"base-task-list-item",style:{listStyle:"none",marginLeft:"-28px"},children:(0,i.jsx)(o.BS,{items:s,onDrop:t=>L({...t,items:s,container:e}),style:{marginTop:"1px"},renderOverlay:(t,l)=>(0,i.jsx)(o.BS.Item,{index:l,id:t.id,title:t.title,hideTrigger:!0,isDragOverlay:!0,children:b(t,0,e,s.length,!1,!0)},t.id),as:"div",children:(0,i.jsx)(n,{className:"base-list-item",style:{marginLeft:l.length!==s.length&&l.length?"5px":"0px"},children:s.map((t,l)=>(0,i.jsx)(o.BS.Item,{index:l,id:t.id,title:t.title,hideTrigger:!0,className:t.isBullet?"TaskListItems-module__bullet-task-item--X_OYA":t.isNumbered?"TaskListItems-module__numbered-task-item--rZ83B":d,as:B(t)?"li":"div",style:{marginLeft:t.isBullet||t.isNumbered||!t.hasDifferentListTypes?"0px":"-28px",marginRight:"-8px"},children:b(t,0,e,s.length,!1,!1)},t.id))})})}),e,t.toString()):null})}),[t,m,u])},$=({child:e,position:t})=>e.isNumbered?t+1<2?"TaskListItems-module__numbered-task-list--qipBK":"TaskListItems-module__numbered-task-list-nested--sSUYp":e.isBullet?t+1<2?"TaskListItems-module__unordered-task-list--Sl3h1":"TaskListItems-module__unordered-task-list-nested--Eju8Y":d,A=({child:e,isDragOverlay:t})=>!e.isBullet&&!e.isNumbered&&(t?"TaskListItems-module__nested-overlay-list--A36Te":e.parentIsChecklist||e.hasDifferentListTypes?"":d),D=({child:e,isDragOverlay:t})=>(e.isBullet||e.isNumbered)&&(t?"TaskListItems-module__overlay-task-list-child--Phee9":""),B=e=>(e.isNumbered||e.isBullet)&&!e.hasDifferentListTypes||e.hasDifferentListTypes||e.children.length>0;try{S.displayName||(S.displayName="TaskListItems")}catch{}var M=s(34164),E=s(88431);let O=[],q=function(e,t,s){let[i,l]=(0,n.useState)([]);return(0,E.N)(()=>{let s=Array.from(e.current?.querySelectorAll(t)??O);l(e=>!function(e,t){if(e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(e[s]!==t[s])return!1;return!0}(e,s)?s:e)},[s,e,t]),i};var P=s(42931);let V=/\b(href|src)\s*=\s*(['"])([^'"?]{1,2000})(\?(?:[^'"]{0,1000}?))token=([^&#"']{0,500})([^'"]{0,1000})\2/gi,K=({verifiedHTML:e,markdownValue:t="",onChange:s,onConvertToIssue:r,onConvertToSubIssue:o,onLinkClick:d,openLinksInNewTab:m=!1,loading:c=!1,disabled:u,viewerCanUpdate:h,className:g})=>{let p=(0,n.useRef)(null),f=q(p,".contains-task-list:not(.contains-task-list .contains-task-list)",e),x=(0,n.useRef)(""),I=(0,n.useMemo)(()=>{var t,s,i;let l;return t=x.current,s=e,i=function(e){let t,s={};V.lastIndex=0;let i=0;for(;null!==(t=V.exec(e))&&!(++i>1e3);){let e=t[3],i=t[4],l=t[5],n=t[6];e&&l&&(s[`${e}${i}token=TOKEN_PLACEHOLDER${n}`]=l)}return s}(t),V.lastIndex=0,l=0,s.replace(V,(e,t,s,n,a,r,o)=>{if(++l>1e3)return e;let d=`${n}${a}token=TOKEN_PLACEHOLDER${o}`;return i.hasOwnProperty(d)?`${t}=${s}${n}${a}token=${i[d]}${o}${s}`:e})},[e]);x.current=I;let{tasklistData:L,nestedItems:y,setTasklistData:b}=((e,t)=>{let[s,i]=(0,n.useState)(()=>new Map),[l,a]=(0,n.useState)(()=>new Map);return(0,E.N)(()=>{if(!e)return;let s=function({container:e,tasklists:t}){let s=new Map,i=new Map,l=function(e,t="ul:not(.base-list-item), ol:not(.base-list-item)"){return Array.from(e.querySelectorAll(t)).filter(e=>!e.closest("tracking-block"))}(e),n=0,a=-1;for(let r of t){let t=Array.from(r.querySelectorAll(":scope > li:not(.base-task-list-item)")),o=r.querySelectorAll(":scope > li.task-list-item"),d=[],{globalIndex:m,markdownIndex:c}=k({container:e,nestedItems:i,globalIndex:n,markdownIndex:a,items:t,itemsData:d,nested:!1,lists:l,parentIsChecklist:r.classList.contains("task-list-item"),hasDifferentListTypes:o.length>0&&o.length!==t.length});for(let e of(n=m,a=c,s.set(r,d),t))e.remove()}return{newData:s,nestedItems:i}}({container:e,tasklists:t});i(s.newData),a(s.nestedItems)},[e,t]),{tasklistData:s,nestedItems:l,setTasklistData:i,setNestedItems:a}})(p.current,f);(0,P.O)({htmlContainerRef:p,onLinkClick:d,openLinksInNewTab:m});let T=(0,n.useMemo)(()=>{let e=["markdown-body","NewMarkdownViewer-module__safe-html-box--dKCgP"];return g&&e.push(g),(0,i.jsx)(a.vb,{ref:p,className:(0,M.$)(e),html:I})},[g,I]);return c?(0,i.jsx)("div",{className:(0,M.$)("NewMarkdownViewer-module__spinner--yFr_i"),children:(0,i.jsx)(l.A,{"aria-label":"Loading markdown content..."})}):(0,i.jsxs)(i.Fragment,{children:[T,f.length>0&&(0,i.jsx)(S,{tasklists:f,markdownValue:t,externalOnChange:s,onConvertToIssue:r,onConvertToSubIssue:o,tasklistData:L,setTasklistData:b,nestedItems:y,disabled:u||!s,viewerCanUpdate:h})]})};try{K.displayName||(K.displayName="NewMarkdownViewer")}catch{}}}]);
//# sourceMappingURL=39837-68423a1e663f.js.map